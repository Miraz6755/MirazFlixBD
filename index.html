
<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function openLinkOnce() {
                window.open("", "_blank");
                document.body.removeEventListener("click", openLinkOnce); // Remove event after first click
            }

            document.body.addEventListener("click", openLinkOnce);
        });
    </script>
    
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Miraz Fix BD</title>
    <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap: content: blob:; media-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap: content: blob:;">
<meta name="referrer" content="no-referrer">
    <script src="https://promoviex.vercel.app/playlist/playjs/playerjs.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            --accent: #E50914;
            --accent-soft: rgba(229, 9, 20, 0.3);
            
            /* DARK MODE DEFAULTS */
            --bg-main: #141414; /* Solid color for sticky background */
            --bg-gradient: radial-gradient(circle at top, #202020 0, #0b0b0b 45%, #000 100%);
            --bg-panel: rgba(0, 0, 0, 0.98);
            --bg-card: #1e1e1e;
            --text-main: #fff;
            --text-sec: #ccc;
            --border-color: rgba(255, 255, 255, 0.15);
        }

        /* LIGHT MODE VARIABLES */
        body.light-mode {
            --bg-main: #f4f4f4;
            --bg-gradient: #f4f4f4;
            --bg-panel: rgba(255, 255, 255, 0.98);
            --bg-card: #ffffff;
            --text-main: #111;
            --text-sec: #555;
            --border-color: rgba(0, 0, 0, 0.1);
        }

        /* BASE STYLES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: var(--bg-gradient);
            background-attachment: fixed; /* Fixes gradient */
            color: var(--text-main);
            min-height: 100vh;
            padding-top: 100px;
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }

        ::-webkit-scrollbar { width: 10px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 3px; }


        /* HEADER & NAVIGATION */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 90px;
            background: var(--bg-panel);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--accent-soft);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            transition: background 0.3s ease;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .site-logo {
            height: 40px;
            width: auto;
            border-radius: 5px;
        }

        .brand-name {
            font-size: 26px;
            font-weight: 700;
            color: var(--accent);
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(229, 9, 20, 0.5);
        }

        .time-display {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-main);
            padding: 10px 16px;
            background: radial-gradient(circle, rgba(229, 9, 20, 0.35), rgba(0,0,0,0.1));
            border-radius: 999px;
            border: 1px solid var(--accent-soft);
        }

        .menu-btn {
            background: var(--accent);
            border: none;
            border-radius: 10px;
            padding: 10px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 4px;
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.4);
        }
        
        .menu-btn .line {
            width: 22px;
            height: 3px;
            background: #fff;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .menu-btn:hover {
            background: #b20710;
        }

        .menu-btn.open .line:nth-child(1) { transform: translateY(7px) rotate(45deg); }
        .menu-btn.open .line:nth-child(2) { opacity: 0; }
        .menu-btn.open .line:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: -350px;
            width: 350px;
            height: 100%;
            background: var(--bg-panel);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--accent-soft);
            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.3);
            transition: left 0.3s ease, background 0.3s ease;
            z-index: 1001;
            padding: 30px 20px;
            overflow-y: auto;
            padding-top: 110px; 
        }

        .sidebar.open { left: 0; }

        .sidebar-title {
            color: var(--accent);
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-soft);
        }

        .sidebar-list {
            list-style: none;
        }

        .sidebar-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            cursor: pointer;
            color: var(--text-sec);
            font-size: 14px;
            background: rgba(125, 125, 125, 0.1);
            border-radius: 8px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-item:hover {
            background: rgba(229, 9, 20, 0.3);
            color: var(--text-main);
        }
        
        .delete-btn {
            color: var(--accent);
            font-size: 20px;
            font-weight: bold;
            opacity: 0.7;
            transition: opacity 0.2s;
            margin-left: 10px;
        }

        .delete-btn:hover {
            opacity: 1;
            color: #fff;
        }

        /* STICKY GROUP (Player, Playlists, Search, Categories) */
        .sticky-group {
            position: sticky;
            top: 90px; /* Header height */
            z-index: 950;
            background: var(--bg-main); /* Crucial: opaque background to hide scrolling content */
            padding-bottom: 10px;
            margin-left: -20px; /* Offset container padding */
            margin-right: -20px;
            padding-left: 20px;
            padding-right: 20px;
            border-bottom: 1px solid transparent;
            transition: background 0.3s;
        }
        
        /* PLAYLIST BAR STYLES */
        .playlist-section-header {
            font-size: 14px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .playlist-bar {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
            margin-bottom: 15px;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }

        .playlist-pill {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-sec);
            background: rgba(255,255,255,0.05);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        body.light-mode .playlist-pill {
            background: #e0e0e0;
            color: #333;
            border-color: #ccc;
        }

        .playlist-pill:hover {
            border-color: var(--accent);
            color: var(--text-main);
        }

        .playlist-pill.active {
            background: var(--accent); /* Original Red accent or whatever theme color */
            color: #fff;
            border-color: var(--accent);
            font-weight: 600;
        }
        
        /* Specific style for Home to look like image */
        .playlist-pill.home-btn.active {
            background: #f00e0e; /* Example Blue for Home if desired, or keep accent */
            border-color: #0066cc;
        }

        /* CATEGORY BAR STYLES */
        .category-bar {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 5px;
            margin-bottom: 0px; /* Bottom of sticky group */
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }

        .category-pill {
            padding: 9px 18px;
            border: 1px solid var(--accent);
            border-radius: 8px;
            color: var(--text-main);
            background: rgba(0,0,0,0.2);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        body.light-mode .category-pill {
            background: #fff;
            color: #111;
        }

        .category-pill:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(229, 9, 20, 0.2);
        }

        .category-pill.active {
            background: #ff1c07; /* Gold/Yellow as per request */
            color: #000;
            border-color: #ff1c07;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
        }

        /* MAIN CONTENT */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px 40px;
        }

        /* PLAYER & CONTROLS */
        .player-wrapper {
            background: #000;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
            margin-bottom: 15px;
            border: 1px solid var(--accent-soft);
            position: relative;
            z-index: 900;
        }

        .video-container {
            width: 100%;
            aspect-ratio: 16/9; 
            background: #000;
            position: relative;
        }

        #videoPlayer1, #videoPlayer2, #videoPlayer3, #videoPlayer4 {
            width: 100%;
            height: 100%;
            display: none;
        }

        #videoPlayer1.active, #videoPlayer2.active, #videoPlayer3.active, #videoPlayer4.active {
            display: block;
        }
        
        #videoPlayer2 {
            background-color: #000;
            border-radius: 0;
        }
        
        #videoPlayer4 iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .player-controls {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px 16px;
            background: rgba(0, 0, 0, 0.8);
        }

        .player-btn {
            font-size: 13px;
            font-weight: 600;
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 999px;
            padding: 8px 18px;
            transition: all 0.25s ease;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .player-btn:hover {
            background: rgba(229, 9, 20, 0.35);
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .player-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.5);
            transform: translateY(0);
        }

        /* SEARCH INPUT */
        .search-input {
            width: 100%;
            padding: 12px 18px;
            font-size: 15px;
            border: 2px solid var(--accent-soft);
            border-radius: 999px;
            background: var(--bg-panel);
            color: var(--text-main);
            outline: none;
            transition: all 0.3s ease;
            margin-bottom: 15px; /* Spacing before categories */
        }

        .search-input::placeholder {
            color: #888;
        }

        .search-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 18px rgba(229, 9, 20, 0.25);
        }

        /* CHANNEL GRID */
        .channel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: 18px;
            padding: 20px 0 5px; /* Added padding top for separation from sticky header */
        }

        .channel-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 12px 14px;
            cursor: pointer;
            transition: all 0.25s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        body.light-mode .channel-card {
             box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .channel-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(229, 9, 20, 0.3);
        }

        .channel-card::before {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ff4545;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
            z-index: 1;
        }
        
        .channel-card.status-online::before { background: #46d369; box-shadow: 0 0 10px #46d369; }
        .channel-card.status-error::before { background: #ffcc00; box-shadow: 0 0 10px #ffcc00; }
        .channel-card.status-offline::before { background: #ff4545; box-shadow: 0 0 10px #ff4545; }

        .channel-card.hidden { display: none; }

        .channel-logo {
            width: 72px;
            height: 72px;
            margin: 0 auto 10px;
            border-radius: 10px;
            object-fit: cover;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .channel-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-main);
            word-break: break-word;
            line-height: 1.35;
        }
        
        /* PROGRESS & MODALS */
        .progress-wrapper {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 12px;
            padding: 10px 14px 12px;
            margin-bottom: 18px;
            display: none;
            border: 1px solid var(--accent-soft);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 999px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .progress-fill {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #ff7a7a);
            border-radius: inherit;
            transition: width 0.15s linear;
        }

        .progress-text { font-size: 12px; color: #ddd; }
        .loading-message { text-align: center; padding: 16px 0; font-size: 14px; color: var(--text-sec); }

        .theme-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 10px; }
        .theme-row span { font-size: 13px; color: var(--text-sec); }
        #themeColorInput { width: 70px; height: 28px; padding: 0; border-radius: 6px; border: 1px solid #444; background: transparent; }
        
        .mode-toggle-btn {
            background: var(--bg-card);
            color: var(--text-main);
            border: 1px solid var(--accent-soft);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            width: 100%;
        }

        /* RECENT LOGO */
        .recent-item-content { display: flex; align-items: center; gap: 8px; }
        .recent-logo { width: 20px; height: 20px; border-radius: 4px; object-fit: cover; }
        
        /* OVERLAY & MODAL STYLES */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); z-index: 1000; display: none; backdrop-filter: blur(3px); }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1e1e1e; border-radius: 12px; padding: 30px 24px 22px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.9); z-index: 1002; width: 90%; max-width: 400px; border: 1px solid var(--accent); display: none; }
        .modal-title { color: var(--accent); font-size: 22px; margin-bottom: 14px; font-weight: 700; text-align: center; }
        .modal-helper { font-size: 13px; color: #ccc; margin-bottom: 15px; text-align: center; opacity: 0.9; }
        .modal input { width: 100%; padding: 12px 15px; margin-bottom: 12px; border: 1px solid var(--accent-soft); border-radius: 6px; background: rgba(255, 255, 255, 0.05); color: #fff; font-size: 15px; outline: none; transition: border-color 0.3s, box-shadow 0.3s, background 0.3s; }
        .modal input:focus { border-color: var(--accent); background: #000; box-shadow: 0 0 10px rgba(229, 9, 20, 0.8); }
        .modal-buttons { display: flex; justify-content: space-between; gap: 10px; margin-top: 10px; }
        .modal-buttons button { flex: 1; padding: 10px 0; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: background 0.3s; font-size: 14px; }
        .modal-confirm { background: var(--accent); color: #fff; }
        .modal-confirm:hover { background: #b20710; }
        .modal-cancel { background: #444; color: #fff; }
        .modal-cancel:hover { background: #555; }

        /* RESPONSIVENESS */
        @media (max-width: 768px) {
            .header { height: 70px; padding: 0 15px; }
            .brand-name { font-size: 20px; }
            body { padding-top: 80px; }
            .container { padding: 20px 14px 28px; }
            .sticky-group { top: 70px; } /* Adjust sticky top */
            .channel-grid { grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; }
            .sidebar { width: 300px; left: -300px; padding-top: 80px; }
        }

        @media (max-width: 480px) {
            .header { height: 60px; }
            .brand-name { font-size: 18px; }
            .site-logo { height: 30px; }
            .time-display { font-size: 11px; padding: 5px 9px; }
            .sticky-group { top: 60px; } /* Adjust sticky top */
            .channel-grid { grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; }
            .channel-logo { width: 60px; height: 60px; }
            .channel-name { font-size: 12px; }
            .player-controls { padding: 10px 12px 12px; }
            .player-btn { padding: 6px 12px; font-size: 11px; }
            .category-pill { padding: 8px 16px; font-size: 13px; }
            .playlist-pill { padding: 6px 12px; font-size: 12px; }
        }
    </style>
</head>
<body>

<header class="header">
    <div class="logo-section">
        <button class="menu-btn" id="menuBtn" aria-label="Toggle menu">
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
        </button>
        
        
      
        <div class="brand-name">MirazPli‚úò BD</div>
    </div>
    <div class="header-right">
        <div class="time-display" id="timeDisplay">00:00:00 AM</div>
    </div>
</header>

<aside class="sidebar" id="sidebar">
    <div class="sidebar-section">
        <div class="sidebar-title">Recent History</div>
        <ul class="sidebar-list" id="recentHistory"></ul>
    </div>

    <div class="sidebar-section">
        <div class="sidebar-title">Playlist Management</div>
        <ul class="sidebar-list">
            <li class="sidebar-item" id="addPlaylistBtn">+ Add Custom Playlist</li>
        </ul>
        <ul class="sidebar-list" id="customPlaylists"></ul>
    </div>

    <div class="sidebar-section">
        <div class="sidebar-title">Direct Play</div>
        <ul class="sidebar-list">
            <li class="sidebar-item" id="directPlayBtn">‚ñ∂ Play URL Directly</li>
        </ul>
    </div>

    <div class="sidebar-section">
        <div class="sidebar-title">Settings</div>
        <ul class="sidebar-list">
            <li class="sidebar-item">
                <div class="theme-row">
                    <span>Accent Color</span>
                    <input type="color" id="themeColorInput">
                </div>
            </li>
            <li class="sidebar-item">
                <button class="mode-toggle-btn" id="modeToggleBtn">Switch to Light Mode</button>
            </li>
        </ul>
    </div>
    
    <div class="sidebar-section">
        <div class="sidebar-title">Other Actions</div>
        <ul class="sidebar-list">
            <li class="sidebar-item" id="clearHistoryBtn">‚ùå Clear History</li>
            <li class="sidebar-item" id="clearPlaylistsBtn">üóëÔ∏è Clear All Custom Playlists</li>
        </ul>
    </div>
</aside>

<div class="overlay" id="overlay"></div>

<div class="modal" id="addPlaylistModal">
    <div class="modal-title">Add Custom Playlist</div>
    <p class="modal-helper">Add any public M3U / M3U8 URL.</p>
    <input type="text" id="playlistNameInput" placeholder="Playlist Name">
    <input type="text" id="playlistUrlInput" placeholder="M3U URL">
    <div class="modal-buttons">
        <button class="modal-cancel" id="cancelPlaylistBtn">Cancel</button>
        <button class="modal-confirm" id="confirmPlaylistBtn">Add Playlist</button>
    </div>
</div>

<div class="modal" id="directPlayModal">
    <div class="modal-title">Direct URL Play</div>
    <p class="modal-helper">Supports MP4, M3U8 and Pixeldrain links</p>
    <input type="text" id="directPlayUrlInput" placeholder="Video URL">
    <div class="modal-buttons">
        <button class="modal-cancel" id="cancelDirectPlayBtn">Cancel</button>
        <button class="modal-confirm" id="confirmDirectPlayBtn">Play Now</button>
    </div>
</div>

<main class="container">
    <div class="sticky-group">
        
        <div class="player-wrapper">
            <div class="video-container">
                <div id="videoPlayer1"></div>
                <video id="videoPlayer2" playsinline></video>
                <div id="videoPlayer3"></div>
                <div id="videoPlayer4"></div>
            </div>
            <div class="player-controls">
                <button class="player-btn active" id="player1Btn">Main</button>
                <button class="player-btn" id="player2Btn">Html5</button>
                <button class="player-btn" id="player3Btn">Clappr</button>
                <button class="player-btn" id="player4Btn">Iframe</button>
            </div>
        </div>

        <div class="playlist-section-header">
            <i class="fas fa-list"></i> PLAYLISTS
        </div>
        <div class="playlist-bar">
            <button class="playlist-pill active home-btn" id="plBtn1">
                <i class="fas fa-home"></i> Home
            </button>
            <button class="playlist-pill" id="plBtn2">
                <i class="fas fa-server"></i> Movie
            </button>
            <button class="playlist-pill" id="plBtn3">
                <i class="fas fa-server"></i> AynaOTT
            </button>
            <button class="playlist-pill" id="plBtn4">
                <i class="fas fa-server"></i> BDIX
            </button>
        </div>

        <input type="text" class="search-input" id="searchInput" placeholder="üîç Search channels...">

        <div class="category-bar" id="categoryBar">
            <button class="category-pill active" data-category="All">All Channels</button>
            </div>

    </div> 
    <div class="progress-wrapper" id="progressWrapper">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div class="progress-text" id="progressText">Loading channels...</div>
    </div>

    <div class="channel-grid" id="channelGrid">
        <div class="loading-message">Loading default playlist...</div>
    </div>
</main>

<script>
    // 1. CONST PLAYLIST URLS (You can change these URLs)
    const PLAYLIST_HOME = 'https://raw.githubusercontent.com/Raisanbd/moive-rplex/refs/heads/main/rplex01.m3u';
    const PLAYLIST_1 = 'https://m3u.work/U6Ok2JI.m3u'; // Example
    const PLAYLIST_2 = 'https://raw.githubusercontent.com/sm-monirulislam/SM-Live-TV/refs/heads/main/AynaOTT.m3u'; // Example
    const PLAYLIST_3 = 'https://raw.githubusercontent.com/sm-monirulislam/RoarZone-Auto-Update-playlist/refs/heads/main/RoarZone.m3u'; // Example

    const urlParams = new URLSearchParams(window.location.search);
    const m3uUrl = urlParams.get('link') || PLAYLIST_HOME;
    
    let allChannels = [];
    let displayedChannelElements = []; 
    let categories = new Set();
    let categoryCounts = {};
    let customPlaylists = [];
    
    // Players
    let player1; 
    let player3; // Clappr
    let currentChannel = { url: null, name: null, logo: null };
    let activePlayer = 'player1';
    let currentCategory = 'All';

    // DOM Elements
    const menuBtn = document.getElementById('menuBtn');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const recentHistory = document.getElementById('recentHistory');
    const categoryBar = document.getElementById('categoryBar'); 
    const addPlaylistBtn = document.getElementById('addPlaylistBtn');
    const customPlaylistsList = document.getElementById('customPlaylists');
    const directPlayBtn = document.getElementById('directPlayBtn');
    // Now Playing is Removed
    
    // Player Buttons
    const player1Btn = document.getElementById('player1Btn');
    const player2Btn = document.getElementById('player2Btn');
    const player3Btn = document.getElementById('player3Btn');
    const player4Btn = document.getElementById('player4Btn');
    
    // Video Containers
    const videoPlayer1Div = document.getElementById('videoPlayer1');
    const videoPlayer2Video = document.getElementById('videoPlayer2');
    const videoPlayer3Div = document.getElementById('videoPlayer3');
    const videoPlayer4Div = document.getElementById('videoPlayer4'); 
    
    const searchInput = document.getElementById('searchInput');
    const themeColorInput = document.getElementById('themeColorInput');
    const modeToggleBtn = document.getElementById('modeToggleBtn');

    // Playlist Buttons
    const plBtn1 = document.getElementById('plBtn1');
    const plBtn2 = document.getElementById('plBtn2');
    const plBtn3 = document.getElementById('plBtn3');
    const plBtn4 = document.getElementById('plBtn4');
    const playlistButtons = [plBtn1, plBtn2, plBtn3, plBtn4];

    // Modals
    const addPlaylistModal = document.getElementById('addPlaylistModal');
    const playlistNameInput = document.getElementById('playlistNameInput');
    const playlistUrlInput = document.getElementById('playlistUrlInput');
    const confirmPlaylistBtn = document.getElementById('confirmPlaylistBtn');
    const cancelPlaylistBtn = document.getElementById('cancelPlaylistBtn');

    const directPlayModal = document.getElementById('directPlayModal');
    const directPlayUrlInput = document.getElementById('directPlayUrlInput');
    const confirmDirectPlayBtn = document.getElementById('confirmDirectPlayBtn');
    const cancelDirectPlayBtn = document.getElementById('cancelDirectPlayBtn');

    const clearHistoryBtn = document.getElementById('clearHistoryBtn');
    const clearPlaylistsBtn = document.getElementById('clearPlaylistsBtn');

    // --- THEME & MODE LOGIC ---
    function loadTheme() {
        const savedColor = localStorage.getItem('mrx_accent_color');
        if (savedColor) {
            document.documentElement.style.setProperty('--accent', savedColor);
            document.documentElement.style.setProperty('--accent-soft', hexToRgba(savedColor, 0.3));
            themeColorInput.value = savedColor;
        } else {
            themeColorInput.value = '#E50914';
        }
        const savedMode = localStorage.getItem('mrx_display_mode');
        if (savedMode === 'light') {
            document.body.classList.add('light-mode');
            modeToggleBtn.textContent = 'Switch to Dark Mode';
        } else {
            document.body.classList.remove('light-mode');
            modeToggleBtn.textContent = 'Switch to Light Mode';
        }
    }

    modeToggleBtn.addEventListener('click', () => {
        document.body.classList.toggle('light-mode');
        if (document.body.classList.contains('light-mode')) {
            localStorage.setItem('mrx_display_mode', 'light');
            modeToggleBtn.textContent = 'Switch to Dark Mode';
        } else {
            localStorage.setItem('mrx_display_mode', 'dark');
            modeToggleBtn.textContent = 'Switch to Light Mode';
        }
    });

    function hexToRgba(hex, alpha) {
        let c = hex.replace('#', '');
        if (c.length === 3) c = c.split('').map(ch => ch + ch).join('');
        const r = parseInt(c.substring(0,2), 16);
        const g = parseInt(c.substring(2,4), 16);
        const b = parseInt(c.substring(4,6), 16);
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    themeColorInput.addEventListener('input', (e) => {
        const color = e.target.value;
        document.documentElement.style.setProperty('--accent', color);
        document.documentElement.style.setProperty('--accent-soft', hexToRgba(color, 0.3));
        localStorage.setItem('mrx_accent_color', color);
    });

    function normalizePixeldrainUrl(inputUrl) {
        if (!inputUrl) return inputUrl;
        try {
            const u = new URL(inputUrl.trim());
            if (!u.hostname.includes('pixeldrain.com')) return inputUrl;
            const parts = u.pathname.split('/').filter(Boolean);
            if (parts[0] === 'u' && parts[1]) return `https://pixeldrain.com/api/file/${parts[1]}`;
            return inputUrl;
        } catch (e) { return inputUrl; }
    }

    // --- Core UI Functions ---
    function toggleMenu() {
        if (addPlaylistModal.style.display === 'block' || directPlayModal.style.display === 'block') {
            closeModal();
            return;
        }
        sidebar.classList.toggle('open');
        menuBtn.classList.toggle('open');
        overlay.style.display = sidebar.classList.contains('open') ? 'block' : 'none';
    }

    function showModal(modalElement) {
        modalElement.style.display = 'block';
        overlay.style.display = 'block';
    }

    function closeModal() {
        addPlaylistModal.style.display = 'none';
        directPlayModal.style.display = 'none';
        if (!sidebar.classList.contains('open')) {
            overlay.style.display = 'none';
        }
    }

    menuBtn.addEventListener('click', toggleMenu);
    overlay.addEventListener('click', () => {
        if (addPlaylistModal.style.display === 'block' || directPlayModal.style.display === 'block') closeModal();
        else if (sidebar.classList.contains('open')) toggleMenu();
    });

    // Player Switching Logic
    function setActivePlayer(pid) {
        activePlayer = pid;
        player1Btn.classList.remove('active');
        player2Btn.classList.remove('active');
        player3Btn.classList.remove('active');
        player4Btn.classList.remove('active');
        
        if (pid === 'player1') player1Btn.classList.add('active');
        if (pid === 'player2') player2Btn.classList.add('active');
        if (pid === 'player3') player3Btn.classList.add('active');
        if (pid === 'player4') player4Btn.classList.add('active');
        
        if (currentChannel.url) {
            playChannel(currentChannel.url, currentChannel.name, currentChannel.logo);
        }
    }

    player1Btn.addEventListener('click', () => { if(activePlayer !== 'player1') setActivePlayer('player1'); });
    player2Btn.addEventListener('click', () => { if(activePlayer !== 'player2') setActivePlayer('player2'); });
    player3Btn.addEventListener('click', () => { if(activePlayer !== 'player3') setActivePlayer('player3'); });
    player4Btn.addEventListener('click', () => { if(activePlayer !== 'player4') setActivePlayer('player4'); });

    // Playlist Switching Logic
    function switchPlaylist(url, activeBtn) {
        allChannels = [];
        displayedChannelElements = [];
        document.getElementById("channelGrid").innerHTML = '<div class="loading-message">Loading playlist...</div>';
        
        playlistButtons.forEach(btn => btn.classList.remove('active'));
        activeBtn.classList.add('active');
        
        fetchM3U(url);
    }

    plBtn1.addEventListener('click', () => switchPlaylist(PLAYLIST_HOME, plBtn1));
    plBtn2.addEventListener('click', () => switchPlaylist(PLAYLIST_1, plBtn2));
    plBtn3.addEventListener('click', () => switchPlaylist(PLAYLIST_2, plBtn3));
    plBtn4.addEventListener('click', () => switchPlaylist(PLAYLIST_3, plBtn4));

    searchInput.addEventListener('input', () => { filterChannels(currentCategory); });

    addPlaylistBtn.addEventListener('click', () => { playlistNameInput.value = ''; playlistUrlInput.value = ''; showModal(addPlaylistModal); });
    cancelPlaylistBtn.addEventListener('click', closeModal);
    confirmPlaylistBtn.addEventListener('click', () => {
        const name = playlistNameInput.value.trim();
        const url = playlistUrlInput.value.trim();
        if (name && url) { addCustomPlaylist(name, url); closeModal(); }
        else alert("Please enter both a name and a valid M3U URL.");
    });

    directPlayBtn.addEventListener('click', () => { directPlayUrlInput.value = ''; showModal(directPlayModal); });
    cancelDirectPlayBtn.addEventListener('click', closeModal);
    confirmDirectPlayBtn.addEventListener('click', () => {
        const url = directPlayUrlInput.value.trim();
        if (url) { playChannel(url, "Direct Play URL", "https://via.placeholder.com/80?text=‚ñ∂Ô∏è"); closeModal(); }
        else alert("Please enter a video URL.");
    });
    
    clearHistoryBtn.addEventListener('click', () => { if(confirm("Clear history?")) { localStorage.removeItem('recentHistory'); renderRecentHistory(); } });
    clearPlaylistsBtn.addEventListener('click', () => { if(confirm("Clear all playlists?")) { localStorage.removeItem('customPlaylists'); customPlaylists = []; renderCustomPlaylists(); } });


    // --- Local Storage & Playlist Functions ---
    function getRecentHistory() { return JSON.parse(localStorage.getItem('recentHistory')) || []; }
    function saveRecentHistory(channel) {
        let history = getRecentHistory();
        history = history.filter(item => item.url !== channel.url);
        history.unshift(channel);
        history = history.slice(0, 5);
        localStorage.setItem('recentHistory', JSON.stringify(history));
        renderRecentHistory();
    }

    function renderRecentHistory() {
        const history = getRecentHistory();
        recentHistory.innerHTML = '';
        if (history.length === 0) { recentHistory.innerHTML = '<li class="sidebar-item">No recent channels</li>'; return; }
        history.forEach(channel => {
            const li = document.createElement('li');
            li.className = 'sidebar-item';
            li.innerHTML = `<div class="recent-item-content"><img class="recent-logo" src="${channel.logo}" onerror="this.src='https://via.placeholder.com/40'"><span>${channel.name}</span></div>`;
            li.onclick = () => { playChannel(channel.url, channel.name, channel.logo); toggleMenu(); };
            recentHistory.appendChild(li);
        });
    }

    function getCustomPlaylists() { return JSON.parse(localStorage.getItem('customPlaylists')) || []; }
    function saveCustomPlaylists() { localStorage.setItem('customPlaylists', JSON.stringify(customPlaylists)); renderCustomPlaylists(); }
    function addCustomPlaylist(name, url) {
        if (customPlaylists.some(p => p.url === url)) { alert("Playlist already exists."); return; }
        customPlaylists.push({ name, url }); saveCustomPlaylists();
    }
    function deleteCustomPlaylist(index) { customPlaylists.splice(index, 1); saveCustomPlaylists(); }

    function renderCustomPlaylists() {
        customPlaylists = getCustomPlaylists();
        customPlaylistsList.innerHTML = '';
        if (customPlaylists.length === 0) return;
        customPlaylists.forEach((playlist, index) => {
            const li = document.createElement('li');
            li.className = 'sidebar-item';
            li.innerHTML = `<span style="flex:1">${playlist.name}</span><span class="delete-btn">√ó</span>`;
            li.querySelector('span').onclick = () => {
                allChannels = []; displayedChannelElements = []; 
                document.getElementById("channelGrid").innerHTML = '<div class="loading-message">Loading custom playlist...</div>';
                fetchM3U(playlist.url); toggleMenu();
            };
            li.querySelector('.delete-btn').onclick = (e) => { e.stopPropagation(); if (confirm(`Delete "${playlist.name}"?`)) deleteCustomPlaylist(index); };
            customPlaylistsList.appendChild(li);
        });
    }

    // --- M3U Parsing ---
    async function fetchM3U(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Status: ${response.status}`);
            const data = await response.text();
            parseM3U(data);
        } catch (error) {
            console.error(error);
            document.getElementById('channelGrid').innerHTML = '<div class="loading-message">Failed to load playlist. Check URL or CORS.</div>';
        }
    }

    function parseM3U(data) {
        const lines = data.split("\n");
        const channels = [];
        let channel = {};
        categories.clear();
        categories.add('All');
        categoryCounts = {};

        lines.forEach(line => {
            line = line.trim();
            if (line.startsWith("#EXTINF")) {
                const nameMatch = line.match(/,(.+)$/); 
                const logoMatch = line.match(/tvg-logo="([^"]*)"/);
                const groupMatch = line.match(/group-title="([^"]*)"/);
                channel = {
                    name: nameMatch ? nameMatch[1].trim() : "Unknown",
                    logo: logoMatch && logoMatch[1] ? logoMatch[1].trim() : "https://via.placeholder.com/80",
                    category: groupMatch && groupMatch[1] ? groupMatch[1].trim() : "Others",
                    status: 'offline'
                };
                if (channel.category) categories.add(channel.category);
            } else if (line && !line.startsWith("#")) {
                channel.url = line;
                if (channel.name && channel.url) channels.push({...channel});
                channel = {}; 
            }
        });

        channels.forEach(ch => {
            const cat = ch.category || 'Others';
            categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;
        });
        
        allChannels = channels;
        initializeChannelDisplay(channels);
        renderCategories(); // Renders the bottom of sticky header
        filterChannels('All');
    }

    async function initializeChannelDisplay(channels) {
        const grid = document.getElementById("channelGrid");
        const progressFill = document.getElementById("progressFill");
        const progressText = document.getElementById("progressText");
        const progressWrapper = document.getElementById("progressWrapper");
        
        grid.innerHTML = "";
        displayedChannelElements = []; 
        if (channels.length === 0) { grid.innerHTML = '<div class="loading-message">No channels found.</div>'; return; }
        
        progressWrapper.style.display = "block";
        const total = channels.length;
        let loaded = 0;
        
        for (let i = 0; i < total; i++) {
            const channel = channels[i];
            const card = document.createElement("div");
            card.className = `channel-card status-${channel.status}`;
            card.innerHTML = `<img class="channel-logo" src="${channel.logo}" onerror="this.src='https://via.placeholder.com/80'"><div class="channel-name">${channel.name}</div>`;
            card.onclick = () => playChannel(channel.url, channel.name, channel.logo, card);
            card.dataset.category = channel.category;
            card.dataset.channelName = channel.name.toLowerCase();
            grid.appendChild(card);
            displayedChannelElements.push({ element: card, name: card.dataset.channelName, category: card.dataset.category });
            
            loaded++;
            if (i % 50 === 0) {
                progressFill.style.width = `${Math.round((loaded/total)*100)}%`;
                progressText.innerText = `Loading ${loaded}/${total}`;
                await new Promise(r => setTimeout(r, 0));
            }
        }
        progressWrapper.style.display = "none";
    }
    
    function updateChannelCardStatus(url, status) {
        // Simple status update for visual feedback
        const card = document.querySelector(`.channel-card[data-channel-url="${CSS.escape(url)}"]`);
        if (card) {
            card.classList.remove('status-online', 'status-offline', 'status-error');
            card.classList.add(`status-${status}`);
        }
    }

    // --- Play Channel Logic ---
    function playChannel(url, name = "Unknown", logo = "", cardElement = null) {
        const playbackUrl = normalizePixeldrainUrl(url);
        currentChannel = { url, name, logo };
        
        // Reset players
        try { if (player1) player1.api("destroy"); } catch (e) {}
        try { if (player3) { player3.destroy(); player3 = null; } } catch (e) {}
        player1 = null;
        
        videoPlayer1Div.innerHTML = '';
        videoPlayer3Div.innerHTML = '';
        videoPlayer4Div.innerHTML = '';
        videoPlayer2Video.pause();
        videoPlayer2Video.removeAttribute('src');
        
        videoPlayer1Div.classList.remove('active');
        videoPlayer2Video.classList.remove('active');
        videoPlayer3Div.classList.remove('active');
        videoPlayer4Div.classList.remove('active');
        
        const handleError = () => { console.error("Playback Error"); if (cardElement) updateChannelCardStatus(url, 'error'); };
        
        if (activePlayer === 'player1') {
            videoPlayer1Div.classList.add('active');
            setTimeout(() => {
                try { player1 = new Playerjs({ id: "videoPlayer1", file: playbackUrl, autoplay: 1 }); } catch (e) { handleError(); }
            }, 50);
        } else if (activePlayer === 'player2') {
            videoPlayer2Video.classList.add('active');
            videoPlayer2Video.setAttribute('controls', 'controls');
            videoPlayer2Video.src = playbackUrl;
            videoPlayer2Video.play().catch(e => console.log(e));
        } else if (activePlayer === 'player3') {
            videoPlayer3Div.classList.add('active');
            try { player3 = new Clappr.Player({ source: playbackUrl, parentId: "#videoPlayer3", width: '100%', height: '100%', autoPlay: true }); } catch (e) { handleError(); }
        } else if (activePlayer === 'player4') {
            videoPlayer4Div.classList.add('active');
            videoPlayer4Div.innerHTML = `<iframe src="${playbackUrl}" allowfullscreen allow="autoplay; encrypted-media" style="width:100%;height:100%;border:none;"></iframe>`;
        }

        saveRecentHistory(currentChannel);
        document.title = `Now Playing: ${name}`;
    }

    // --- Category Rendering Logic ---
    function renderCategories() {
        categoryBar.innerHTML = '';
        
        const allBtn = document.createElement('button');
        allBtn.className = 'category-pill active';
        allBtn.textContent = 'All Channels';
        allBtn.onclick = () => { 
            filterChannels('All'); 
            document.querySelectorAll('.category-pill').forEach(b => b.classList.remove('active'));
            allBtn.classList.add('active');
        };
        categoryBar.appendChild(allBtn);
        
        Array.from(categories).sort().forEach(cat => {
            if (cat && cat !== 'All') {
                const btn = document.createElement('button');
                btn.className = 'category-pill';
                btn.textContent = cat;
                btn.onclick = () => {
                    filterChannels(cat);
                    document.querySelectorAll('.category-pill').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                };
                categoryBar.appendChild(btn);
            }
        });
    }

    function filterChannels(category = 'All') {
        currentCategory = category;
        const searchTerm = searchInput.value.toLowerCase();
        displayedChannelElements.forEach(item => {
            const matchesSearch = item.name.includes(searchTerm);
            const matchesCategory = (category === 'All' || item.category === category);
            if (matchesSearch && matchesCategory) item.element.classList.remove('hidden');
            else item.element.classList.add('hidden');
        });
    }

    function updateClock() {
        const now = new Date();
        document.getElementById("timeDisplay").textContent = now.toLocaleTimeString();
    }

    window.addEventListener('DOMContentLoaded', () => {
        loadTheme();
        renderRecentHistory();
        renderCustomPlaylists();
        updateClock();
        setInterval(updateClock, 1000);
        fetchM3U(m3uUrl);
    });
</script>
<!--Use the specified version-->
<script disable-devtool-auto src='https://cdn.jsdelivr.net/npm/disable-devtool@x.x.x'></script>
<!--Use latest version-->
<script disable-devtool-auto src='https://cdn.jsdelivr.net/npm/disable-devtool@latest'></script></body>

</body>
</html>
